name: CI
on: 
  workflow_dispatch:
  schedule:
  - cron:  '0 0 * * *'
jobs:
  composer:
    runs-on: ubuntu-latest
    steps:
      - name: Get current date
        id: date
        run: echo " ::set-output name=date::$(date +'%Y-%m-%d')"
      - uses: actions/checkout@v1
      - uses: nanasess/setup-php@master
        with:
          php-version: '7.4'

      - run: git config --global user.email "support@svlstudios.com" && git config --global user.name "SVL Studios"
      
      - name: Check file existence
        id: check_files
        uses: andstor/file-existence-action@v1
        with:
          files: "google_fonts.json"

      - name: File exists
        if: steps.check_files.outputs.files_exists == 'true'
        # Only runs if all of the files exists
        # run: git rm google_fonts.json && git commit -a -m "Delete" && git push "https://x-access-token:$GITHUB_TOKEN@github.com/$GITHUB_REPOSITORY" HEAD:master
      
      - run: php ./run.php ${{ secrets.GOOGLE_TOKEN }}
        env:
          GOOGLE_TOKEN: ${{secrets.GOOGLE_TOKEN}}
      
      - run: git add -f google_fonts.json
      - run: readonly local last_commit_log=$(git log -1 --pretty=format:"%s")
      - run: echo "last commit log: $last_commit_log"
      - run: git commit -q -m "Google Fonts Update: ${{ steps.date.outputs.date }} (Build $GITHUB_RUN_NUMBER)"
      - run: git push "https://x-access-token:$GITHUB_TOKEN@github.com/$GITHUB_REPOSITORY" HEAD:master
      
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
